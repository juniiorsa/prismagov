<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrismaGov - Clareza e Decisão para o Setor Público</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Alpine.js for interactivity -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@latest/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F2F4F8;
            color: #1F2937;
        }
        .bg-azul-eletrico { background-color: #0074E4; }
        .text-azul-eletrico { color: #0074E4; }
        .border-azul-eletrico { border-color: #0074E4; }
        .bg-verde-menta { background-color: #24C9A0; }
        .text-verde-menta { color: #24C9A0; }
        .bg-roxo-prisma { background-color: #7D3FD1; }
        .text-roxo-prisma { color: #7D3FD1; }
        .gradient-text {
            background: linear-gradient(90deg, #0074E4, #24C9A0, #7D3FD1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; text-fill-color: transparent;
        }
        .cta-button {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px -5px rgba(0, 116, 228, 0.4);
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px -5px rgba(0, 116, 228, 0.6);
        }
        .floating-cta {
            position: fixed; bottom: 20px; right: 20px; z-index: 50;
            background-color: #0074E4; color: white; padding: 14px 24px;
            border-radius: 9999px; font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 116, 228, 0.3);
            transition: all 0.3s ease;
        }
        .floating-cta:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 116, 228, 0.5); }
        [x-cloak] { display: none !important; }
        .page, .app-page { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body x-data="app()" x-cloak>

    <!-- Botão de CTA Flutuante (só aparece deslogado) -->
    <a href="#" x-show="!isLoggedIn" @click.prevent="currentPage = 'demo'" class="floating-cta hidden md:inline-block">Solicitar Demonstração</a>

    <!-- Visualização para usuários DESLOGADOS -->
    <div id="marketing-view" x-show="!isLoggedIn">
        <header class="bg-white/80 backdrop-blur-lg fixed top-0 left-0 right-0 z-50 shadow-sm">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <a href="#" @click.prevent="currentPage = 'home'" class="flex items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-auto" viewBox="0 0 450 100"><defs><linearGradient id="gH" x1="0%" y1="100%" x2="0%" y2="0%"><stop offset="0%" stop-color="#0074E4"/><stop offset="50%" stop-color="#24C9A0"/><stop offset="100%" stop-color="#7D3FD1"/></linearGradient></defs><g transform="translate(0, -5) scale(0.9)"><g transform="translate(18, 0) scale(0.9)"><path d="M 35 15 H 85 L 85 90 H 35 Z" fill="#E5E7EB"/><path d="M 85 15 L 70 30 H 85 Z" fill="#D1D5DB"/><g transform="translate(-5, 0)"><path d="M 40 85 L 40 15 L 60 25 L 60 75 Z" fill="#4A5568"/><polygon points="60,25 105,50 60,75" fill="#2D3748"/><polygon points="60,25 105,50 80,25" fill="#718096"/></g><path d="M 100 50 L 163 22 L 163 78 Z" fill="url(#gH)"/></g></g><g transform="translate(185, 20)"><text y="40" font-family="Montserrat, sans-serif" font-size="40" font-weight="700" fill="#1F2937">Prisma<tspan fill="#0074E4">Gov</tspan></text></g></svg>
                    </a>
                    <nav class="hidden md:flex items-center space-x-8">
                        <a href="#" @click.prevent="currentPage = 'solution'" class="text-gray-600 hover:text-azul-eletrico transition">Soluções</a>
                        <a href="#" @click.prevent="currentPage = 'benefits'" class="text-gray-600 hover:text-azul-eletrico transition">Benefícios</a>
                        <a href="#" @click.prevent="currentPage = 'about'" class="text-gray-600 hover:text-azul-eletrico transition">Sobre Nós</a>
                        <a href="#" @click.prevent="currentPage = 'faq'" class="text-gray-600 hover:text-azul-eletrico transition">FAQ</a>
                    </nav>
                    <div class="hidden md:flex items-center space-x-4">
                        <a href="#" @click.prevent="currentPage = 'login'" class="text-gray-600 font-semibold hover:text-azul-eletrico transition">Acessar</a>
                        <a href="#" @click.prevent="currentPage = 'demo'" class="bg-azul-eletrico text-white font-semibold px-5 py-2 rounded-lg cta-button">Solicitar Demo</a>
                    </div>
                </div>
            </div>
        </header>

        <div id="page-container">
            <!-- As páginas de marketing serão injetadas aqui -->
        </div>

        <footer class="bg-gray-800 text-white" x-show="!isLoggedIn">
            <!-- Conteúdo do Footer -->
        </footer>
    </div>

    <!-- Visualização para usuários LOGADOS (APP SHELL) -->
    <div id="app-shell" x-show="isLoggedIn" x-cloak>
        <!-- Conteúdo do App Shell -->
    </div>

    <script>
        function app() {
            return {
                isLoggedIn: false, mobileMenuOpen: false, currentPage: 'home', currentAppPage: 'inicio',
                user: null, credentials: { email: '', password: '' }, apiBaseUrl: 'http://localhost:3001/api/v1',
                documents: [], isLoading: false,
                newDocumentData: { titulo: '', natureza: '', problema: '', resultados: '' },
                wizard: { currentStep: 1, tr_id: null, statusText: 'Aguardando início...', documentContent: { title: 'Termo de Referência (em construção)', dna: '', prices: '' }},
                init() {
                    const token = localStorage.getItem('authToken');
                    if (token) {
                        this.isLoggedIn = true;
                        try {
                            const payload = JSON.parse(atob(token.split('.')[1]));
                            this.user = { id: payload.sub, name: payload.name, email: payload.email };
                        } catch (e) { this.logout(); }
                    }
                },
                async login() {
                    this.isLoading = true;
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.credentials),
                        });
                        const data = await response.json();
                        if (!response.ok) throw new Error(data.message || 'Credenciais inválidas.');
                        
                        localStorage.setItem('authToken', data.access_token);
                        const payload = JSON.parse(atob(data.access_token.split('.')[1]));
                        this.user = { id: payload.sub, name: payload.name, email: payload.email };
                        this.isLoggedIn = true;
                        this.navigateAppTo('inicio');
                        this.credentials = { email: '', password: '' };
                    } catch (err) {
                        alert('Erro de Login: ' + err.message);
                    } finally {
                        this.isLoading = false;
                    }
                },
                logout() {
                    localStorage.removeItem('authToken');
                    this.isLoggedIn = false;
                    this.user = null;
                    this.currentPage = 'home';
                },
                async getDocuments() {
                    if (!this.isLoggedIn) return;
                    this.isLoading = true;
                    try {
                        const token = localStorage.getItem('authToken');
                        const response = await fetch(`${this.apiBaseUrl}/documentos`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (!response.ok) throw new Error('Falha ao buscar documentos.');
                        this.documents = await response.json();
                    } catch (err) {
                        alert(err.message);
                    } finally {
                        this.isLoading = false;
                    }
                },
                async createDocument() {
                    if (!this.isLoggedIn) return;
                    this.isLoading = true;
                    this.wizard.statusText = 'Analisando DNA da Contratação...';
                    
                    const payload = { ...this.newDocumentData, formulario_id: crypto.randomUUID() };
                    this.wizard.tr_id = payload.formulario_id;
                    
                    try {
                        const token = localStorage.getItem('authToken');
                        const response = await fetch(`${this.apiBaseUrl}/documentos/novo`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
                            body: JSON.stringify(payload),
                        });
                        if (!response.ok) throw new Error((await response.json()).message || 'Falha ao criar o documento.');
                        
                        await this.sleep(1500);
                        this.wizard.documentContent.title = payload.titulo;
                        this.wizard.documentContent.dna = `<h2>1. Definição da Necessidade</h2><p><strong>Problema a ser resolvido:</strong> ${payload.problema}</p><p><strong>Resultados esperados:</strong> ${payload.resultados}</p><p><strong>Natureza do Objeto:</strong> ${payload.natureza}</p>`;
                        this.wizard.currentStep = 2;
                        this.wizard.statusText = 'Aguardando análise de preços...';
                    } catch (err) {
                        alert('Erro: ' + err.message);
                        this.wizard.tr_id = null;
                    } finally {
                        this.isLoading = false;
                    }
                },
                navigateAppTo(page) {
                    this.currentAppPage = page;
                    if (page === 'documentos') this.getDocuments();
                    document.querySelectorAll('.app-nav-link').forEach(link => {
                        const isCurrent = link.dataset.page === page;
                        link.classList.toggle('bg-gray-200', isCurrent);
                        link.classList.toggle('text-gray-700', isCurrent);
                        link.classList.toggle('font-semibold', isCurrent);
                        link.classList.toggle('text-gray-500', !isCurrent);
                    });
                     window.scrollTo(0, 0);
                },
                statusClass(status) {
                    switch(status) {
                        case 'finalizado': return 'bg-verde-menta/20 text-verde-menta';
                        case 'em_processamento': return 'bg-roxo-prisma/20 text-roxo-prisma';
                        case 'erro': return 'bg-red-500/20 text-red-500';
                        default: return 'bg-gray-200 text-gray-600';
                    }
                },
                sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
            }
        }
        
        const iconMappings = {
            'icon-inicio': 'Home', 'icon-documentos': 'Files', 'icon-tr': 'FilePlus2', 'icon-etp': 'FileText', 
            'icon-dfd': 'FileSpreadsheet', 'icon-config': 'Settings', 'icon-suporte': 'LifeBuoy', 
            'icon-logout': 'LogOut', 'icon-doc-start': 'FileText'
        };

        function renderIcons() {
             for (const [id, name] of Object.entries(iconMappings)) {
                const container = document.getElementById(id);
                if(container){
                    const iconElement = React.createElement(lucide[name], { size: (id === 'icon-doc-start' ? 48 : 20), className: (id === 'icon-doc-start' ? 'mx-auto text-gray-300' : '') });
                    ReactDOM.render(iconElement, container);
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => { renderIcons(); });
    </script>
</body>
</html>
